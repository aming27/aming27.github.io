---
ID: 454
title: 'Team Foundation Server: Mac OS X+Java+Eclipse+Maven'
author: fernandoescolar
post_date: 2012-11-26 09:41:48
post_excerpt: ""
layout: post
---
<p>Hace unos meses, me encontraba en un cliente hablando de la posibilidad de sustituir su conjunto de aplicativos para&nbsp; ALM (Application Lifecycle Management o gestión del ciclo de vida de las aplicaciones) por el potente TFS de Microsoft. Se mostró fascinado por la herramienta: estuvimos navegando por el portal, mostrándole las gráficas y lo fácil que era gestionar todo el trabajo. No obstante, el líder tecnológico era escéptico y no confiaba en las capacidades del entorno que estábamos proponiendo. </p>
<!--break-->
<p>Así que le retamos a proponernos el escenario más complejo que podríamos encontrarnos en su empresa. Tras unos segundos de silencio, su respuesta fue concisa: macbook air, programando en Java y que use Maven.</p> <h3>Challenge accepted</h3> <p>Desempolvé el mac-mini y en lo que se instalaba el eclipse, creamos un nuevo proyecto dentro de la cuenta de Team Foundation Service de Programando en .Net.</p> <p><a href="/assets/uploads/2012/11/001.png"><img title="00" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="00" src="/assets/uploads/2012/11/00_thumb1.png" width="398" height="396"></a></p> <p>Alguno puede pensar que pecamos de soberbia, utilizando un entorno más adverso incluso que el propuesto. Pero en realidad, era lo único de lo que disponíamos sin gastar demasiado tiempo y dinero. Nuestro escenario se componía de:</p> <ul> <li>Un mac-mini de una generación tan antigua que no recuerdo ni el número. Pero actualizado a un Mac OS X 10.7.3.  <li>En lugar del TFS2012, decidimos usar el TFS en azure, para no perder tiempo buscando un equipo medio potente y tener que instalarlo. Sabiendo que esta versión carece de ciertas características, y lo que es más importante, que se encuentra en la nube, por lo que no podemos hacer "trampas".  <li>Para desarrollar usamos eclipse, en la ultima versión del momento. Y el Maven que viene instalado por defecto en el sistema operativo de la manzana. </li></ul> <p>El siguiente paso fue crear el proyecto de Java para Maven, con el arquetipo de "quickstart", desde eclipse:</p> <p align="center"><a href="/assets/uploads/2012/11/011.png"><img title="01" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="01" src="/assets/uploads/2012/11/01_thumb1.png" width="375" height="326"></a>&nbsp;<a href="/assets/uploads/2012/11/021.png"><img title="02" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="02" src="/assets/uploads/2012/11/02_thumb1.png" width="379" height="324"></a></p> <p>Añadimos un pequeño "hello world" para no complicarnos demasiado el reto. Comprobamos que compilaba y se ejecutaba correctamente, y llegó el momento de añadirlo al control de código fuente de Team Foundation Service.</p> <p>Para ayudarnos ha hacerlo tuvimos que instalar un plugin para eclipse. Antiguamente era conocido como "Visual Studio Team Explorer Everywhere", pero hoy en día lo encontraremos con el nombre de "TFS Plugin for eclipse":</p> <p><a href="/assets/uploads/2012/11/031.png"><img title="03" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="03" src="/assets/uploads/2012/11/03_thumb1.png" width="520" height="464"></a></p> <p>Lo mejor de este plugin es que para los que estemos acostumbrados a Visual Studio, la única dificultad que vamos a encontrar, es mostrar la ventana de "Team Explorer". Y es que eclipse viene lleno de ventanas por defecto y tendremos que hacer una pequeña búsqueda para encontrar la nuestra:</p> <p align="center"><a href="/assets/uploads/2012/11/051.png"><img title="05" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="05" src="/assets/uploads/2012/11/05_thumb1.png" width="297" height="376"></a>&nbsp; <a href="/assets/uploads/2012/11/061.png"><img title="06" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="06" src="/assets/uploads/2012/11/06_thumb1.png" width="283" height="376"></a></p> <p>Una vez la hemos activado veremos exactamente el mismo control, con todas (en realidad no todas, faltan las nuevas opciones de code review) las características que podemos encontrar en la versión, por así llamarla, original:</p> <p><a href="/assets/uploads/2012/11/041.png"><img title="04" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="04" src="/assets/uploads/2012/11/04_thumb1.png" width="601" height="268"></a></p> <p>Para conectar con el proyecto que creamos al inicio del artículo, solo tuvimos que crear una nueva conexión añadiendo la dirección del TFS. En este caso, como usamos la versión de azure, introducimos la URL con "https://" por delante. Después seleccionamos el proyecto adecuado en el listado. Y ya teníamos acceso a todos los work items, las builds y control de código fuente.</p> <p align="center"><a href="/assets/uploads/2012/11/071.png"><img title="07" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="07" src="/assets/uploads/2012/11/07_thumb1.png" width="373" height="233"></a>&nbsp;<a href="/assets/uploads/2012/11/081.png"><img title="08" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="08" src="/assets/uploads/2012/11/08_thumb1.png" width="380" height="233"></a></p> <p>Para continuar, lo que teníamos que hacer era indicarle a eclipse que el código proyecto actual iba a ser gestionado por TFS. Por lo que en el explorador de paquetes, seleccionamos la raíz del proyecto y buscamos la opción de compartir con Team Foundation Server:</p> <p align="center"><a href="/assets/uploads/2012/11/091.png"><img title="09" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="09" src="/assets/uploads/2012/11/09_thumb1.png" width="323" height="320"></a>&nbsp;<a href="/assets/uploads/2012/11/101.png"><img title="10" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="10" src="/assets/uploads/2012/11/10_thumb1.png" width="400" height="318"></a></p> <p>Al realizar esta asociación, automáticamente se actualizó la información de la ventana de Team Explorer con los datos del proyecto listos para hacer check in.</p> <p><a href="/assets/uploads/2012/11/111.png"><img title="11" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="11" src="/assets/uploads/2012/11/11_thumb1.png" width="246" height="413"></a></p> <p>Así que ya teníamos la mitad del camino recorrido. Habíamos conseguido conectar el entorno y subir el código fuente para que a partir de ahora fuera TFS quien lo gestionara. Pero a partir de aquí las cosas se iban a poner más difíciles, porque TFS "de fabrica" no puede crear builds de proyectos en lenguajes que no sean de la plataforma de Microsoft. Aunque si que nos facilita integrarnos con otras tecnologías.</p> <p>Para crear una build automatizada de integración continua, lo primero que tenemos que hacer es exactamente lo mismo que en cualquier sistema: instalar las herramientas. En este caso las herramientas que usamos erán la JDK y Maven. Y un detalle importante que hay que tener en cuenta, es que TFS está instalado en máquinas Windows, por lo que tuvimos que descargar las versiones para ese sistema operativo.</p> <p><a href="/assets/uploads/2012/11/121.png"><img title="12" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="12" src="/assets/uploads/2012/11/12_thumb1.png" width="486" height="408"></a></p> <p>El caso de Maven fue muy sencillo, porque directamente desde su página web pudimos descargar los binarios. Pero en cuanto al SDK de Java, tuvimos que pivotar en un ordenador con Windows. Ahí instalamos las herramientas y las copiamos en un pen drive, para al final tenerlas en el mac.</p> <p align="center"><a href="/assets/uploads/2012/11/131.png"><img title="13" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="13" src="/assets/uploads/2012/11/13_thumb1.png" width="521" height="297"></a>&nbsp;<a href="/assets/uploads/2012/11/141.png"><img title="14" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="14" src="/assets/uploads/2012/11/14_thumb1.png" width="238" height="295"></a></p> <p>Creamos una carpeta llamada "tools" en el directorio local, que contenía el jdk y el Maven. Y en el control de código fuente creamos la misma estructura de directorios, pero vacía, para poder sincronizarlos. Acto seguido nos dirigimos al "Team Explorer", al panel de "Pending Changes" y en acciones buscamos la opción de detectar cambios. Así conseguimos sincronizar ambas carpetas.</p> <p align="center"><a href="/assets/uploads/2012/11/151.png"><img title="15" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="15" src="/assets/uploads/2012/11/15_thumb1.png" width="272" height="270"></a>&nbsp;<a href="/assets/uploads/2012/11/161.png"><img title="16" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="16" src="/assets/uploads/2012/11/16_thumb1.png" width="496" height="270"></a></p> <p>Después de hacer check in con estos cambios, ya teníamos disponibles las herramientas que íbamos a utilizar dentro de TFS, por lo que solo nos quedaba configurar la build. Entonces nos dirigimos al "Team Explorer", al panel de builds y ahí creamos una nueva:</p> <p align="center"><a href="/assets/uploads/2012/11/171.png"><img title="17" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="17" src="/assets/uploads/2012/11/17_thumb1.png" width="226" height="312"></a>&nbsp; <a href="/assets/uploads/2012/11/181.png"><img title="18" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="18" src="/assets/uploads/2012/11/18_thumb1.png" width="307" height="304"></a></p> <p>Ante nosotros se abrió una ventana con un wizard que nos ayudaría a definir la build. Empezamos asignando un nombre:</p> <p><a href="/assets/uploads/2012/11/191.png"><img title="19" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="19" src="/assets/uploads/2012/11/19_thumb1.png" width="527" height="357"></a></p> <p>Seguimos los pasos del wizard y en la segunda pantalla configuramos la planificación de la´s ejecuciones. La idea que teníamos era crear una de tipo "continuous integration", que se lanzara en cada nuevo check in, comprobando la integridad del nuevo código.</p> <p><a href="/assets/uploads/2012/11/201.png"><img title="20" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="20" src="/assets/uploads/2012/11/20_thumb1.png" width="526" height="352"></a></p> <p>Después configuramos los directorios de trabajo. Aquí asociamos las rutas dentro del control de código fuente, con variables de ejecución de la build. Diferenciamos entre el código fuente y las herramientas:</p> <ul> <li>$/nuestro-proyecto/demo –&gt; $(SourceDir)\src  <li>$/nuestro-proyecto/demo/tools –&gt; $(SourceDir)\tools </li></ul> <p><a href="/assets/uploads/2012/11/211.png"><img title="21" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="21" src="/assets/uploads/2012/11/21_thumb1.png" width="529" height="356"></a></p> <p>En la siguiente pantalla definimos una carpeta dentro del control de código fuente donde almacenar los resultados de las diferentes ejecuciones. Lo que comúnmente se conoce como "drop folder".</p> <p><a href="/assets/uploads/2012/11/221.png"><img title="22" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="22" src="/assets/uploads/2012/11/22_thumb1.png" width="527" height="304"></a></p> <p>Team Foundation Server usa proyectos de MsBuild para realizar las builds. Para poder editar el proyecto creamos una carpeta nueva en el control del código fuente y en la siguiente pantalla la configuramos. Esto implicaba que cuando termináramos de definir la build, podríamos dirigirnos a esta carpeta y explorar los archivos para modificar configuraciones a mano.</p> <p><a href="/assets/uploads/2012/11/231.png"><img title="23" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="23" src="/assets/uploads/2012/11/23_thumb1.png" width="532" height="360"></a></p> <p>Como el sistema no encontró un archivo de proyecto en la carpeta que introducimos, nos indicó que teníamos que crear un proyecto nuevo. Así que lo hicimos presionando el botón de "create". Entonces una nueva ventana se abrió y nos dio a elegir entre una configuración basada en un archivo de build de Ant o en un archivo POM de Maven. Seleccionamos esta última y buscamos en el repositorio de código fuente, el archivo "pom.xml" de nuestro proyecto. Este archivo fue creado por el arquetipo de Maven, dentro de eclipse, de forma automática.</p> <p align="center"><a href="/assets/uploads/2012/11/241.png"><img title="24" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="24" src="/assets/uploads/2012/11/24_thumb1.png" width="362" height="289"></a>&nbsp;<a href="/assets/uploads/2012/11/251.png"><img title="25" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="25" src="/assets/uploads/2012/11/25_thumb1.png" width="365" height="288"></a></p> <p>Una vez ya habíamos creado el proyecto de MsBuild, nos dirigimos a la última pantalla del wizard. Aquí se pueden definir las políticas de retención. Es decir, el lugar donde decidimos qué información y cuando queremos guardarla, sobre los resultados de la ejecución de la build. Nosotros dejamos las opciones que vienen por defecto.</p> <p><a href="/assets/uploads/2012/11/261.png"><img title="26" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="26" src="/assets/uploads/2012/11/26_thumb1.png" width="542" height="363"></a></p> <p>Para finalizar tuvimos que configurar unos parámetros de entorno que desafortunadamente no tenían pantalla que nos ayudara a configurarlos. Así que buscamos la carpeta con los archivos de proyecto que definimos antes, y la mapeamos a un directorio local.</p> <p><a href="/assets/uploads/2012/11/271.png"><img title="27" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="27" src="/assets/uploads/2012/11/27_thumb1.png" width="542" height="237"></a></p> <p>Entonces abrimos el archivo "TFSBuild.proj". Y antes de que acabará la sección de "PropertyGroup", justo antes de "ItemGroup", añadimos los directorios donde MsBuild va a buscar el JDK y Maven:</p> <ul> <li>&lt;JAVA_HOME&gt;$(SolutionRoot)\tools\jdk&lt;/JAVA_HOME&gt;  <li>&lt;M2_HOME&gt;$(SolutionRoot)\tools\maven&lt;/M2_HOME&gt; </li></ul> <p><a href="/assets/uploads/2012/11/281.png"><img title="28" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="28" src="/assets/uploads/2012/11/28_thumb1.png" width="542" height="311"></a></p> <p>La peculiaridad es que aunque usemos diferentes versiones de Maven, la variable siempre se llamará "M2_HOME". Pero en este caso subimos la última versión del momento, una 3.</p> <p>A partir de este momento ya teníamos la build configurada y lista para ser lanzada. Para probarlo nos dirigimos al panel correspondiente de "Team Explorer" y marcado la build que acabábamos de crear seleccionamos la opción del menú contextual "Queue new build".</p> <p><a href="/assets/uploads/2012/11/291.png"><img title="29" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="29" src="/assets/uploads/2012/11/29_thumb1.png" width="349" height="427"></a></p> <p>Esperamos a que la ejecución terminara y pudimos ver en los resultados que había sido exitosa:</p> <p><a href="/assets/uploads/2012/11/301.png"><img title="30" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="30" src="/assets/uploads/2012/11/30_thumb1.png" width="509" height="372"></a></p> <p>En adición, comprobamos que cuando insertábamos código erróneo (concretamente borramos un ";") la build fallaba. Así ya podíamos estar seguros de que todo estaba correcto en nuestro entorno.</p> <h3>Conclusiones</h3> <p>Con la satisfacción de haber conseguido superar el reto en unas horas, presentamos los resultados a nuestro cliente. Y aunque aún no sabemos si ha decidido migrar o no, estamos seguros de que, al igual que nosotros, habrá aprendido mucho de esta prueba de concepto.</p> <p>Team Foundation Server, a parte de sus conocidas virtudes, se ha mostrado como una herramienta muy potente y válida para equipos mixtos: con diferentes lenguajes de programación y entornos de trabajo. Y en definitiva, seguiremos recomendándola siempre que un cliente nos pregunte por una buena herramienta que le ayude en la gestión de sus proyectos.</p>